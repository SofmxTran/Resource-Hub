<%- include('../partials/head', { title }) %>
<%- include('../partials/navbar') %>
<div class="container py-4">
  <%- include('../partials/messages') %>
  <h1 class="mb-3">Manage Resources</h1>
  <p class="text-muted">Approve public submissions or audit content.</p>
  <div class="card shadow-sm border-0 mb-4">
    <div class="card-body">
      <form class="row gy-2 gx-3 align-items-end">
        <div class="col-md-3">
          <label class="form-label">Status</label>
          <select class="form-select" name="status">
            <option value="all" <%= status === 'ALL' || status === 'all' ? 'selected' : '' %>>
              All
            </option>
            <% allowedStatuses.forEach((st) => { %>
            <option value="<%= st %>" <%= status === st ? 'selected' : '' %>>
              <%= st %>
            </option>
            <% }) %>
          </select>
        </div>
        <div class="col-md-2">
          <button class="btn btn-primary">Filter</button>
        </div>
      </form>
    </div>
  </div>

  <div class="card shadow-sm border-0">
    <div class="card-body">
      <% if (resources.length) { %>
      <div class="table-responsive">
        <table class="table align-middle">
          <thead>
            <tr>
              <th>Title</th>
              <th>Owner</th>
              <th>Domain</th>
              <th>Type</th>
              <th>Public?</th>
              <th>Status</th>
              <th>Trust</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% resources.forEach((res) => { %>
            <tr>
              <td>
                <a href="/resources/<%= res.id %>" class="text-decoration-none fw-semibold"><%= res.title %></a>
                <p class="mb-0 small text-muted"><%= res.description || '' %></p>
              </td>
              <td>@<%= res.username %></td>
              <td><%= res.domain_name || 'Uncategorized' %></td>
              <td><%= res.type %></td>
              <td><%= res.is_public ? 'Yes' : 'No' %></td>
              <td>
                <span class="badge <%= res.status === 'APPROVED' ? 'bg-success' : res.status === 'PENDING' ? 'bg-warning text-dark' : 'bg-danger' %>">
                  <%= res.status %>
                </span>
              </td>
              <td><strong><%= res.trust_score || 0 %></strong></td>
              <td>
                <div class="d-flex flex-wrap gap-2">
                  <a href="/resources/<%= res.id %>" class="btn btn-sm btn-outline-dark">View</a>
                  <% if (res.status === 'PENDING' && res.is_public) { %>
                  <form
                    action="/admin/resources/<%= res.id %>/approve"
                    method="POST"
                    class="d-inline"
                  >
                    <button class="btn btn-sm btn-success">Approve</button>
                  </form>
                  <form
                    action="/admin/resources/<%= res.id %>/reject"
                    method="POST"
                    class="d-inline"
                  >
                    <button class="btn btn-sm btn-outline-warning">Reject</button>
                  </form>
                  <% } %>
                  <form
                    action="/admin/resources/<%= res.id %>/delete"
                    method="POST"
                    class="d-inline"
                    onsubmit="return confirm('Delete this resource? This cannot be undone.');"
                  >
                    <button class="btn btn-sm btn-outline-danger">Delete</button>
                  </form>
                </div>
              </td>
            </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
      <% } else { %>
      <p class="text-muted mb-0">No resources match that filter.</p>
      <% } %>
    </div>
  </div>
</div>
<%- include('../partials/footer') %>

